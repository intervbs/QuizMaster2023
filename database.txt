CREATE TABLE accounts (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(63) NOT NULL,
    last_name VARCHAR(63) NOT NULL,
    email VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,
    username VARCHAR(63) NOT NULL,
    admin BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE quizzes (
    quiz_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    description TEXT NOT NULL DEFAULT 'No Description Added'
    category VARCHAR(50) NOT NULL,
    is_public BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE questions (
    question_id INT PRIMARY KEY AUTO_INCREMENT,
    quiz_id INT NOT NULL,
    question_text VARCHAR(255) NOT NULL,
    choice1_text VARCHAR(255) NOT NULL,
    choice2_text VARCHAR(255) NOT NULL,
    choice3_text VARCHAR(255) NOT NULL,
    choice4_text VARCHAR(255) NOT NULL,
    choice1_correct BOOLEAN NOT NULL DEFAULT FALSE,
    choice2_correct BOOLEAN NOT NULL DEFAULT FALSE,
    choice3_correct BOOLEAN NOT NULL DEFAULT FALSE,
    choice4_correct BOOLEAN NOT NULL DEFAULT FALSE,
    FOREIGN KEY (quiz_id) REFERENCES quizzes(quiz_id) ON DELETE CASCADE
);

CREATE TABLE quiz_responses (
    response_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    quiz_id INT NOT NULL,
    question_id INT NOT NULL,
    choice1_selected BOOLEAN NOT NULL DEFAULT FALSE,
    choice2_selected BOOLEAN NOT NULL DEFAULT FALSE,
    choice3_selected BOOLEAN NOT NULL DEFAULT FALSE,
    choice4_selected BOOLEAN NOT NULL DEFAULT FALSE,
    FOREIGN KEY (user_id) REFERENCES accounts(user_id) ON DELETE CASCADE,
    FOREIGN KEY (quiz_id) REFERENCES quizzes(quiz_id) ON DELETE CASCADE,
    FOREIGN KEY (question_id) REFERENCES questions(question_id) ON DELETE CASCADE
);


@app.route('/editquiz', methods=['GET', 'POST'])
@admin_required
def edit_quiz():
    '''Function to add, edit or delete questions in the quiz'''
    form = forms.questions()
    if form.validate_on_submit():
        question_text   = form.question_text.data
        answer_1        = form.answer_1.data
        answer_2        = form.answer_2.data
        answer_3        = form.answer_3.data
        answer_4        = form.answer_4.data
        correct_answer_1 = form.correct_answer_1.data
        correct_answer_2 = form.correct_answer_2.data
        correct_answer_3 = form.correct_answer_3.data
        correct_answer_4 = form.correct_answer_4.data
        with myDB() as db:
            print(quiz_id)
            quiz_id = request.args.get('quiz_id')
            print('Dette er en ID:',quiz_id)
            db.add_question(quiz_id, question_text, answer_1, correct_answer_1, 
                            answer_2, correct_answer_2, answer_3, correct_answer_3,
                            answer_4, correct_answer_4)
            flash('New question added to quiz!')
            return redirect(url_for('loggedin'))
    return render_template('edit_quiz.html', quiz_id=quiz_id, form=form)

    with myDB() as db:
                db.update_question(question_id, form.question_text.data, form.answer_1.data, form.correct_answer_1.data,
                                    form.answer_2.data, form.correct_answer_2.data, form.answer_3.data, form.correct_answer_3.data,
                                    form.answer_4.data, form.correct_answer_4.data)


    </form> 
    <form method="POST" action="{{ url_for('edit_quiz') }}">
        {{ form.csrf_token }}
        <div class="form-group">
            {{ form.question.label }}
            {{ form.question(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.choice1.label }}
            {{ form.choice1(class="form-control") }}
            {{ form.is_correct1(class="form-control") }}
        </div>
        <div class="form-group">
          {{ form.choice2.label }}
          {{ form.choice2(class="form-control") }}
          {{ form.is_correct2(class="form-control") }}
        </div>
        <div class="form-group">
          {{ form.choice3.label }}
          {{ form.choice3(class="form-control") }}
          {{ form.is_correct3(class="form-control") }}
        </div>
        <div class="form-group">
          {{ form.choice4.label }}
          {{ form.choice4(class="form-control") }}
          {{ form.is_correct4(class="form-control") }}
        </div>
        <button type="submit" class="quizlink">Add new question</button>
    </form>